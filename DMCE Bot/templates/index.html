<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>DMCE Bot</title>
  <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image" sizes="16x16">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='assets/bootstrap/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/ionicons.min.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/Login-Form-Dark.css') }}">

</head>

<body>
  <section class="msger">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <!--a class="navbar-brand" href="#">DMCE Bot</a-->
      <a class="navbar-brand" href="#" style="color: white;">
        &emsp;<i class="fas fa-graduation-cap"></i> <b> &nbsp; DMCE BOT &emsp; </b></a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">

          <li class="nav-item active"><a class="nav-link" href="/index">Home</a></li>


          <li class="nav-item">
            <a class="nav-link" data-toggle="modal" data-target="#exampleModalScrollable"
              href="https://www.dmce.ac.in/about/about_dmce"> About Us </a>
          </li>

          <!-- <li class="nav-item">
            <a class="nav-link" data-toggle="modal" data-target="#exampleModal" href="#">Suggestion box</a>
          </li> -->


          <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Suggestion box</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form action='/suggestion' method='POST'>
                    <div class="form-group">
                      <input type="email" name='uemail' class='form-control' placeholder="Email" required>
                      <br>
                      <textarea class="form-control" id="message-text" placeholder="Enter your suggestion..."
                        name="message" required></textarea>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="Submit" class="btn btn-primary" data-target="#alert">Submit</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div class="modal fade" id="exampleModalScrollable" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalScrollableTitle"> DMCE BOT </h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <h3>About Us</h3>
                  <div>
                    <img
                      src="https://content3.jdmagicbox.com/comp/navi_mumbai/95/022p8900095/catalogue/datta-meghe-college-of-engineering-airoli-navi-mumbai-colleges-2sl4n01528.jpg?clr=333333"
                      width="100%" alt="image NA">
                  </div>
                  <br>
                  <p style="text-align: justify;">Datta Meghe College of Engineering(DMCE) was founded in 1988 and has
                    touched innumerable milestones ever since. Our institute is accredited by NAAC as well as approved
                    by AICTE, New Delhi. Sitting under the umbrella of the Mumbai University, being one of the most
                    reputed institutes is also recognized by DTE & Govt. of Maharashtra.

                  <p style="text-align: justify;">The overall intake of our institute is 837, ranging at all levels from
                    UG to PG to Phd. With a variety of branches including Civil, Civil and Infrastructure, Mechanical,
                    Computer, IT, Chemical and Electronics Engineering, our highly highly qualified faculty nurtures
                    over 3000 students annually.Our faculty that forms the backbone of the institute, represents
                    national Bodies like Bureau of Indian Standards, Indian Society of Technical Education, IIIE etc.
                  </p>

                  <p style="text-align: justify;">At the university level they make their presence in the Board of
                    studies as members of several departments. As an effort to place students in prestigious
                    organizations we have delineated long term strategy to develop and strengthen the relationship with
                    the corporate world, and have established healthy relations with the industry. We stress on
                    practical knowledge and industry based learning supported by Industry-Institute interaction and a
                    large alumni.</p>

                  <!-- <ul>
                    <li style = "margin-left:15px">Email: principal@dmce.ac.in</li>
                    <li style = "margin-left:15px">Phone no: (022)27797130/27791665</li>
                    </ul> -->
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

          <!-- <li class="nav-item"><a class="nav-link" href="/logout">Log Out</a></li> -->

        </ul>
      </div>


    </nav>
    <!--header class="msger-header">
      <div class="msger-header-title">
        <h5><i class="fas fa-graduation-cap"></i> <b> &emsp; DMCE BOT &emsp; </b><i class="fas fa-graduation-cap"></i></h5>
      </div>
    </header-->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-success alert-dismissible" id="alert" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <strong>{{ message }}</strong>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}


    <main class="msger-chat" style="color: white;">
      </br>
      <div class="msg left-msg">
        <div class="msg-img"
          style="background-image: url(https://cdn.dribbble.com/users/1953813/screenshots/5350927/chatbot-icon.jpg)">
        </div>
        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name"><b>DMCE BOT</b> </div>
          </div>

          <div class="msg-text" name="speak" style="color: white;">
            <b >Hi there, Welcome to DMCE ðŸ‘‹ If you need any assistance, I'm always here.
          </div>
        </div>
      </div>
      <div class="msg left-msg">
        <div class="msg-img"
          style="background-image: url(https://cdn.dribbble.com/users/1953813/screenshots/5350927/chatbot-icon.jpg)">
        </div>
        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name"> <b>DMCE BOT</b></div>
          </div>

          <div class="msg-text" style="color: white;">
            Which of the following user groups do you belong to?

            <br><br>1.&emsp;Student's Section Enquiry.</br> 2.&emsp;Parent's Section Enquiry.</br> 3.&emsp;Visitor's
            Section Enquiry.</br>

          </div>

        </div>
      </div>

    </main>

    <form class="msger-inputarea">
      <input type="text" class="msger-input" id="textInput" placeholder="Enter your enquiry number...">
      <button type="submit" id="texttospeech" class="msger-send-btn">Send</button>
      <button onclick="voice()" type="submit" class="msger-send-btn" id="speechtotext">Click to Speak</button>
      <!-- <button onclick="textToAudio()" type="submit" class="msger-send-btn" id="texttospeech">Click to Make Speak</button> -->
      <!-- <button onclick="voice()" type="submit" class="msger-send-btn" id="speechtotext">Click to Speak</button> -->
    </form>
  </section>
  <!-- partial -->
  <script src='https://use.fontawesome.com/releases/v5.0.13/js/all.js'></script>
  <script>

    $("#alert").delay(3000).slideUp(200, function () {
      $(this).alert('close');
    });

    $('#myModal').on('shown.bs.modal', function () {
      $('#myInput').trigger('focus')
    })

    const msgerForm = get(".msger-inputarea");
    const msgerInput = get(".msger-input");
    const msgerChat = get(".msger-chat");


    const BOT_IMG = "https://cdn.dribbble.com/users/1953813/screenshots/5350927/chatbot-icon.jpg";
    // const PERSON_IMG = "https://image.flaticon.com/icons/svg/145/145867.svg";
    const PERSON_IMG = "file:///C:/Users/Anshu/OneDrive/Desktop/Screenshot%20(201).png";
    const BOT_NAME = "DMCE Bot";
    const PERSON_NAME = "You";

    msgerForm.addEventListener("submit", event => {
      event.preventDefault();

      const msgText = msgerInput.value;
      if (!msgText) return;

      appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
      msgerInput.value = "";
      botResponse(msgText);
    });

    function appendMessage(name, img, side, text) {
      //   Simple solution for small apps
      const msgHTML = `
<div class="msg ${side}-msg">
  <div class="msg-img" style="background-image: url(${img})"></div>

  <div class="msg-bubble">
    <div class="msg-info">
      <div class="msg-info-name">${name}</div>
      <div class="msg-info-time">${formatDate(new Date())}</div>
    </div>

    <div class="msg-text">${text}</div>
  </div>
</div>
`;

      msgerChat.insertAdjacentHTML("beforeend", msgHTML);
      msgerChat.scrollTop += 500;
    }

    // Bot Response 
    function botResponse(rawText) {

      // <div class="msg-text" style="color: white;">
      // function voice() {
      //   let mic = document.getElementById("speechtotext");
      //   const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      //   const recognition = new SpeechRecognition();
      //   recognition.onresult = function (e) {
      //     let resultIndex = e.resultIndex;
      //     let transcript = e.results[resultIndex][0].transcript;

      //     console.log(transcript);
      //   }

      //   mic.addEventListener("click", function () {
      //     recognition.start();
      //   })
      //   console.log("Activated");
      // }

      $.get("/get", { msg: rawText }).done(function (data) {
        console.log(rawText);
        console.log(data);
        const msgText = data;
        appendMessage(BOT_NAME, BOT_IMG, "left", msgText);

        // speech function
        // function voice(){
        //          var recognition = new webkitSpeechRecognition();
        //          recognition.lang="en-GB"
        //          recognition.onresult = function(event){
        //                 console.log(event);
        //                 document.getElementById("speechtotext").value = event.results[0][0].transcript;
        //                 console.log(event.results)
        //                 const transcript = Array.from(event.results)
        //                 .map(result => result[0])
        //                 .map(result => result.transcript)
        //                 .join('')
        //                 console.log(transcript)
        //          }
        //          recognition.start();
        // }
      });

    }

    // Utils
    function get(selector, root = document) {
      return root.querySelector(selector);
    }

    function formatDate(date) {
      const h = "0" + date.getHours();
      const m = "0" + date.getMinutes();

      return `${h.slice(-2)}:${m.slice(-2)}`;
    }

    // Speech to text function
    function voice() {
      var recognition = new webkitSpeechRecognition();
      recognition.lang = "en-GB"
      recognition.onresult = function (event) {
        console.log(event);
        document.getElementById("textInput").value = event.results[0][0].transcript;
        console.log(event.results)
        const transcript = Array.from(event.results)
          .map(result => result[0])
          .map(result => result.transcript)
          .join('')
        console.log(transcript)
      }
      recognition.start();
    }

    // Text to Speech 
    // function textToAudio() {
    //             let msg = document.getElementsByName("speak").value;
    //             // let string(msg) = document.getElementsByClassName("msg-text").value;
    //             // let msg = document.getElementById("texttoaudio").value;
                
    //             let speech = new SpeechSynthesisUtterance();
    //             speech.lang = "en-US";
                
    //             speech.text = msg;
    //             speech.volume = 1;
    //             speech.rate = 1;
    //             speech.pitch = 1;
                
    //             window.speechSynthesis.speak(speech);
    //         }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
</body>

</html>